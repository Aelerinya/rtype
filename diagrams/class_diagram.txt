@startuml

package "Game Engine" #DDDDDD {
    class Game {
        __ private __
        -string m_name
        -map<string, IModule> m_modules
        __ public __
        +StateMachine stateMachine
        +ComponentStorage componentStorage
        __ public __
        +Game(string name)
        +addModule(string name, IModule module)
        +optional<IModule> module(string name)
        +run()
    }

    interface IModule {
        __ public __
        +update()
        +~IModule()
    }
    Game *-- IModule

    class StateMachine {
        __ private __
        -stack<IState> m_statesStack
        +unique_ptr<IState> currentState
        __ public __
        +StateMachine()
        +setState(IState state)
        +stackState(IState state)
        +leaveCurrentState()
    }
    Game o-- StateMachine

    class ComponentStorage {
        __ private __
        -vector<bool> m_dead
        -map<string, any> m_storage
        -unsigned m_entityCount
        friend EntityBuilder
        -EntityBuilder m_builder
        __ public __
        +ComponentStorage()
        +registerComponent<T>()
        +vector<vector<any>> getComponents(vector<string> components)
        +EntityBuilder &buildEntity()
        +destroyEntity(size_t id)
        +~ComponentStorage()
    }
    Game o-- ComponentStorage

    class EntityBuilder {
        __ private __
        -map<string, any> m_components
        -unique_ptr<ComponentStorage> m_dest
        __ public __
        +EntityBuilder &withComponent<T>(T component)
        +size_t build()
    }
    ComponentStorage *-- EntityBuilder

    interface IState {
        __ public __
        +on_start()
        +on_pause()
        +on_resume()
        +tick()
        +on_stop()
    }
    StateMachine *-- IState
}

package "Server" #DDDDDD {
    interface IServerModule {
        __ public __
        +long initInstance(unsigned maxPlayers)
        +optional<Instance> getInstance()
        +~IServerModule()
    }
    IModule <|-- IServerModule

    class Instance {
        __ private __
        -long m_id
        __ public __
        +long getId()
        +bool isFull()
        +unsigned getClientsCount()
        +close()
    }
    IServerModule *-- Instance
}

@enduml
